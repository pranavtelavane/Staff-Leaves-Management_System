<div class="container-fluid p-4">

  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h4 class="fw-bold mb-0">Staff Management</h4>
    </div>

    <div class="d-flex gap-2">
      <input
        type="text"
        class="form-control"
        style="width: 220px"
        placeholder="Search staff..."
        [(ngModel)]="searchText"
        (input)="applySearchAndSort()"
      />

      <button
        class="btn btn-primary"
        data-bs-toggle="modal"
        data-bs-target="#addStaffModal"
        (click)="openAddStaffModal()"
      >
        Add Staff
      </button>
    </div>
  </div>

  <!-- STAFF TABLE -->
  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th (click)="sort('name')" style="cursor:pointer">Full Name</th>
            <th (click)="sort('username')" style="cursor:pointer">Username</th>
            <th (click)="sort('email')" style="cursor:pointer">Email</th>
            <th>Mobile</th>
            <th class="text-center">Action</th>
          </tr>
        </thead>

        <tbody>
          @for (staff of pagedStaff; track staff.id) {
            <tr>
              <td>{{ staff.name }}</td>
              <td>{{ staff.username }}</td>
              <td>{{ staff.email }}</td>
              <td>{{ staff.mobile }}</td>
              <td class="text-center">
                <button
                  class="btn btn-sm btn-outline-primary me-1"
                  data-bs-toggle="modal"
                  data-bs-target="#viewStaffModal"
                  (click)="viewStaff(staff)">
                  View
                </button>

                <button
                  class="btn btn-sm btn-danger"
                  (click)="deleteStaff(staff.id)">
                  Delete
                </button>
              </td>
            </tr>
          }

          @if (pagedStaff.length === 0) {
            <tr>
              <td colspan="5" class="text-center text-muted py-4">
                No staff found
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- PAGINATION -->
  <div class="d-flex justify-content-between align-items-center mt-3">
    <button
      class="btn btn-outline-secondary"
      (click)="prev()"
      [disabled]="page === 1">
      ← Previous
    </button>

    <span class="text-muted">
      Page {{ page }} of {{ totalPages }}
    </span>

    <button
      class="btn btn-outline-secondary"
      (click)="next()"
      [disabled]="page === totalPages">
      Next →
    </button>
  </div>
</div>

<!-- VIEW STAFF MODAL -->
<div class="modal fade" id="viewStaffModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Staff Details</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      @if (selectedStaff) {
        <div class="modal-body">
          <div class="text-center mb-3">
            <img
              [src]="selectedStaff.profilePhoto || 'https://via.placeholder.com/120'"
              class="rounded-circle"
              width="120"
              height="120"
            />
          </div>

          <ul class="list-group list-group-flush">
            <li class="list-group-item"><b>Name:</b> {{ selectedStaff.name }}</li>
            <li class="list-group-item"><b>Username:</b> {{ selectedStaff.username }}</li>
            <li class="list-group-item"><b>Email:</b> {{ selectedStaff.email }}</li>
            <li class="list-group-item"><b>Mobile:</b> {{ selectedStaff.mobile }}</li>
            <li class="list-group-item"><b>Department:</b> {{ selectedStaff.department }}</li>
            <li class="list-group-item"><b>Role:</b> {{ selectedStaff.role }}</li>
          </ul>
        </div>
      }

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<!-- ADD STAFF MODAL -->
<div class="modal fade" id="addStaffModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Add Staff</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form [formGroup]="addStaffForm" (ngSubmit)="submitAddStaff()">
        <div class="modal-body">
          <div class="row g-3">

            <div class="col-md-6">
              <label class="form-label">Name</label>
              <input class="form-control" formControlName="name" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Username</label>
              <input class="form-control" formControlName="username" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Email</label>
              <input class="form-control" formControlName="email" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Mobile</label>
              <input class="form-control" formControlName="mobile" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Password</label>
              <input type="password" class="form-control" formControlName="password" />
            </div>

            <div class="col-md-6">
              <label class="form-label">Profile Photo</label>
              <input
                type="file"
                class="form-control"
                accept="image/*"
                (change)="onPhotoSelect($event)"
              />
            </div>
          </div>

          @if (profilePreview) {
            <div class="text-center mt-3">
              <img
                [src]="profilePreview"
                width="100"
                height="100"
                class="rounded-circle"
              />
            </div>
          }
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-success" type="submit">Add Staff</button>
        </div>
      </form>

    </div>
  </div>
</div>
